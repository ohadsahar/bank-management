<ng4-loading-spinner [threshold]="isLoading" [timeout]="9999999" [loadingText]="'Please wait...'" [zIndex]="9999">
</ng4-loading-spinner>

<div class="cards-management-component">
  <section class="cards-list">
    <div class="row">
      <div class="col-sm-12">
        <mat-accordion displayMode="flat" multi class="mat-table">
          <section matSort class="mat-elevation-z2 mat-header-row">
            <span class="mat-header-cell" mat-sort-header="options">אפשרויות</span>
            <span class="mat-header-cell" mat-sort-header="cardName">שם הכרטיס</span>
            <span class="mat-header-cell" mat-sort-header="typeProduct">תאריך חיוב</span>
          </section>
          <mat-expansion-panel *ngFor="let item of displayedRows$ | async; let i = index">
            <mat-expansion-panel-header class="mat-row">
              <span class="mat-cell"> <i class="fas fa-trash" (click)="deleteCard(item._id)"></i>
                <i class="fas fa-edit" (click)="editCard(item);editoptionsable[i] = !editoptionsable[i]"
                  *ngIf="!editoptionsable[i] && !updateAble"></i>
                <i class="fas fa-check-double" *ngIf="editoptionsable[i]"
                  (click)="updateCard();editoptionsable[i] = !editoptionsable[i]"></i>
                <i class="fas fa-times" *ngIf="editEnable && editoptionsable[i]"
                  (click)="cancelUpdate();editoptionsable[i] = !editoptionsable[i]"></i>
              </span>
              <span class="mat-cell">{{item?.cardName}}</span>
              <span class="mat-cell">{{item?.billingDate}}</span>
            </mat-expansion-panel-header>
            <div *ngIf="!editoptionsable[i]">
              <ul>
                <li>שם הכרטיס: {{item?.cardName}}</li>
                <li>תאריך לחיוב: {{item?.billingDate}}</li>
              </ul>
            </div>
            <section *ngIf="editoptionsable[i]" class="edit-section">
              <h1>עריכת כרטיס</h1>
              <div class="row">
                <div class="col-sm-12">
                  <mat-form-field class="new-transaction">
                    <mat-select [(ngModel)]="editCardForm.cardName" value="{{editCardForm.cardName}}">
                      <mat-option *ngFor="let card of cards" [value]="card?.cardName">
                        {{card?.cardName}}
                      </mat-option>
                    </mat-select>
                    <mat-placeholder class="placeholder" *ngIf="editCardForm.cardName.length > 0">
                      {{editCardForm?.cardName}}</mat-placeholder>
                    <mat-placeholder class="placeholder" *ngIf="editCardForm.cardName.length <= 0">שם הכרטיס
                    </mat-placeholder>
                    <mat-error>חובה למלא שם כרטיס</mat-error>
                  </mat-form-field>
                </div>
                <div class="col-sm-12">
                  <mat-form-field class="new-transaction edit-section" >
                    <input type="text" aria-label="Number" matInput [(ngModel)]="editCardForm.billingDate"
                      value="{{editCardForm.billingDate}}">
                    <mat-placeholder class="placeholder">תאריך לחיוב</mat-placeholder>
                    <mat-error>חובה למלא תאריך לחיוב</mat-error>
                  </mat-form-field>
                </div>
              </div>
            </section>
          </mat-expansion-panel>
        </mat-accordion>
        <mat-paginator #paginator [length]="totalRows$ | async" [pageIndex]="0" [pageSize]="10"
          [pageSizeOptions]="[5, 10, 25, 100]"></mat-paginator>
      </div>
    </div>
  </section>
</div>

<div class="cards-management-component" *ngIf="!isLoading">
  <section class="card-form">
    <form #cardForm="ngForm" (submit)="createNewCard(cardForm)" ngForm>
      <mat-form-field class="full-width">
        <input matInput type="text" name="cardName" #cardName="ngModel" ngModel  required>
        <mat-placeholder class="placeholder">שם הכרטיס</mat-placeholder>
        <mat-error *ngIf="cardName.invalid">חובה להכניס את שם הכרטיס</mat-error>
      </mat-form-field>
      <mat-form-field class="full-width">
        <input matInput type="number" name="billingDate" #billingDate="ngModel" ngModel
          required>
          <mat-placeholder class="placeholder">תאריך חיוב</mat-placeholder>
        <mat-error *ngIf="billingDate.invalid">חובה להכניס את יום החיוב</mat-error>
      </mat-form-field>
      <button type="submit" mat-raised-button color="link" style="font-weight: bold;">צור כרטיס חדש</button>
    </form>
  </section>
</div>
